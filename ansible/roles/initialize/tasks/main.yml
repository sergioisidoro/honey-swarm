---
- name: Install python
  become: true
  package:
    name:
      - python3-dev
      - python3-jsondiff
    state: present
    update_cache: yes

- name: "Install additional user packages"
  become: true
  package:
    name: "{{ item }}"
    state: present
  with_items: "{{ additional_packages }}"

- name: Create locales
  locale_gen:
    name: fi_FI.UTF-8
    state: present

- name: "Add all the users who are supposed to access the nodes"
  import_tasks: set-users.yml
  when: users is defined

- name: ensure github.com is a known host
  lineinfile:
    dest: /root/.ssh/known_hosts
    create: yes
    state: present
    line: "{{ lookup('pipe', 'ssh-keyscan -t rsa github.com') }}"
    regexp: "^github\\.com"

- name: ensure gitlab.com is a known host
  lineinfile:
    dest: /root/.ssh/known_hosts
    create: yes
    state: present
    line: "{{ lookup('pipe', 'ssh-keyscan -t rsa gitlab.com') }}"
    regexp: "^gitlab\\.com"